<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>advanced_alchemy.repository._sync - Docs</title>
    <link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />
  <script>
    const isDarkTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const sessionTheme = sessionStorage['_theme']
    if (sessionTheme) {
      document.documentElement.classList.add(sessionTheme)
    } else if (isDarkTheme) {
      document.documentElement.classList.add('dark')
    }
  </script><link rel="shortcut icon" href="../../../_static/logo.png"/><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=aecf457f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=2981b36d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=ee381b95" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=bf5addad" />
    <style>
:root {
  --sy-f-sys:-apple-system, BlinkMacSystemFont, Segoe UI, Oxygen, Ubuntu, Droid Sans, Helvetica Neue;--sy-f-cjk:PingFang SC, Hiragino Sans GB, Droid Sans Fallback, Microsoft YaHei;--sy-f-heading:var(--sy-f-sys), var(--sy-f-cjk), sans-serif;--sy-f-text:var(--sy-f-sys), var(--sy-f-cjk), sans-serif;--sy-f-mono:Menlo, Monaco, Consolas, "Courier New", monospace;--sy-c-divider:rgba(var(--sy-rc-text), 0.1);--sy-c-divider-weak:rgba(var(--sy-rc-text), 0.05);--sy-c-border:rgba(var(--sy-rc-text), 0.14);--sy-s-banner-height:0rem;--sy-s-navbar-height:56px;--sy-s-offset-top:calc(var(--sy-s-navbar-height) + var(--sy-s-banner-height));--sy-c-link:rgb(var(--sy-rc-theme));--sy-c-link-weak:rgba(var(--sy-rc-theme), 0.86);
  --sy-rc-theme:245, 0, 87;--sy-rc-bg:255, 255, 255;--sy-rc-invert:245, 0, 87;--sy-rc-text:245, 0, 87;--sy-c-bg:#fff;--sy-c-bg-weak:0, 0, 0;--sy-c-text:#000000;--sy-c-text-weak:#f50057;--sy-c-heading:#f50057;--sy-c-bold:#f50057;--sy-c-foot-text:#000000;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#f50057;
}
@media (prefers-color-scheme: light) {
  :root {
    --sy-rc-theme:245, 0, 87;--sy-rc-bg:255, 255, 255;--sy-rc-invert:245, 0, 87;--sy-rc-text:245, 0, 87;--sy-c-bg:#fff;--sy-c-bg-weak:0, 0, 0;--sy-c-text:#000000;--sy-c-text-weak:#f50057;--sy-c-heading:#f50057;--sy-c-bold:#f50057;--sy-c-foot-text:#000000;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#f50057;
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --sy-rc-theme:245, 0, 87;--sy-rc-bg:0, 0, 0;--sy-rc-invert:245, 0, 87;--sy-rc-text:245, 0, 87;--sy-c-bg:#f50057;--sy-c-bg-weak:#000000;--sy-c-text:#ebdddd;--sy-c-text-weak:#f50057;--sy-c-heading:#f50057;--sy-c-bold:#f50057;--sy-c-foot-text:#ebdddd;--sy-c-foot-bg:#000000;--sy-c-foot-divider:#f50057;
  }
}
html.light {
  --sy-rc-theme:245, 0, 87;--sy-rc-bg:255, 255, 255;--sy-rc-invert:245, 0, 87;--sy-rc-text:245, 0, 87;--sy-c-bg:#fff;--sy-c-bg-weak:0, 0, 0;--sy-c-text:#000000;--sy-c-text-weak:#f50057;--sy-c-heading:#f50057;--sy-c-bold:#f50057;--sy-c-foot-text:#000000;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#f50057;
}
html.dark {
  --sy-rc-theme:245, 0, 87;--sy-rc-bg:0, 0, 0;--sy-rc-invert:245, 0, 87;--sy-rc-text:245, 0, 87;--sy-c-bg:#f50057;--sy-c-bg-weak:#000000;--sy-c-text:#ebdddd;--sy-c-text-weak:#f50057;--sy-c-heading:#f50057;--sy-c-bold:#f50057;--sy-c-foot-text:#ebdddd;--sy-c-foot-bg:#000000;--sy-c-foot-divider:#f50057;
}
</style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-heading: Inter, var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="advanced_alchemy.repository._sync"/>
<meta name="twitter:card" content="summary"/></head>
<body><div class="document"><div class="announcement">
    <div class="announcement-inner">
      <p>This documentation is currently under development.</p>
      <button class="announcement-close" aria-label="Close announcement">
        <i class="i-icon close"></i>
      </button>
    </div>
  </div><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand mr-4" href="/">
      <img class="light-logo" src="../../../_static/logo.png" alt="advanced_alchemy" height="28" />
      <img class="dark-logo" src="../../../_static/logo.png" alt="advanced_alchemy" height="28" />
      <strong>advanced_alchemy</strong>
    </a>
    <div class="sy-head-links" id="NavLinks">
      <nav class="sy-head-nav">

<ul><li class="link">
          <a href="https://advanced-alchemy.jolt.rs"><span>Home</span><i class="i-icon external-link"></i></a>
        </li><li class="link">
          <a href="https://docs.advanced-alchemy.jolt.rs"><span>Docs</span><i class="i-icon external-link"></i></a>
        </li><li class="link">
          <a href="https://github.com/jolt-org/advanced-alchemy"><span>Code</span><i class="i-icon external-link"></i></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form>
        
        
        <div class="sy-head-social flex items-center">
            <a class="flex items-center" href="https://github.com/jolt-org/advanced-alchemy" aria-label="GitHub">
              <i class="i-icon github"></i>
            </a>
        </div>
      </div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden">
      <button class="js-theme theme-switch flex items-center" data-aria-light="Switch to dark mode" data-aria-dark="Switch to light mode">
        <i class="i-icon theme-icon"></i>
      </button>
      <button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="NavLinks" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading"><span class="caption-text">Advanced Alchemy Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/placeholder.html">Placeholder</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/base.html">base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/exceptions.html">exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/filters.html">filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/operations.html">operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/repository.html">repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/types.html">types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/alembic/index.html">alembic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/alembic/commands.html">commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/alembic/templates/asyncio/index.html">asyncio</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/asyncio/alembic-ini.html">alembic.ini</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/asyncio/env.html">env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/asyncio/script-py.html">script.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/alembic/templates/sync/index.html">sync</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/sync/alembic-ini.html">alembic.ini</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/sync/env.html">env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/alembic/templates/sync/script-py.html">script.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/config/index.html">config</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/asyncio.html">asyncio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/common.html">common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/engine.html">engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/sync.html">sync</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/types.html">types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/extensions/index.html">extensions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extensions/litestar/index.html">litestar</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/alembic.html">alembic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/cli.html">cli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/dto.html">dto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/index.html">plugins</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/serialization.html">serialization</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/plugin.html">plugin</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/config/asyncio.html">asyncio</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/config/common.html">common</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/config/engine.html">engine</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/config/sync.html">sync</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/extensions/litestar/plugins/init/config/types.html">types</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extensions/sanic.html">sanic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extensions/starlette.html">starlette</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribution-guide.html">Contribution guide</a></li>
</ul>

        </div>
      </div>
      
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-icon close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/jolt-org/advanced-alchemy"
  data-type="github" data-user="jolt-org" data-repo="advanced-alchemy">
  <span class="w-8 flex items-center justify-around shrink-0 text-2xl">
    <i class="i-icon github"></i>
  </span>
  <span class="flex-grow px-2">
    <span>jolt-org/advanced-alchemy</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <i class="i-icon star"></i>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <i class="i-icon git-fork"></i>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
    <div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-icon menu"></i>
      </button>
    </div>
    <ul class="flex-1">
      
      
      <li><a href="../../../index.html">advanced_alchemy</a><span>/</span></li>
      
      <li><a href="../../index.html">Module code</a><span>/</span></li>
      
      <li><strong>advanced_alchemy.repository._sync</strong></li>
      
      
    </ul>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-icon outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for advanced_alchemy.repository._sync</h1><div class="highlight"><pre>
<span></span><span id="1-1"><span class="c1"># Do not edit this file directly. It has been autogenerated from</span>
</span><span id="1-2"><span class="c1"># advanced_alchemy/repository/_async.py</span>
</span><span id="1-3"><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="1-4">
</span><span id="1-5"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Final</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">cast</span>
</span><span id="1-6">
</span><span id="1-7"><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-8">    <span class="n">Result</span><span class="p">,</span>
</span><span id="1-9">    <span class="n">Select</span><span class="p">,</span>
</span><span id="1-10">    <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-11">    <span class="n">TextClause</span><span class="p">,</span>
</span><span id="1-12">    <span class="n">delete</span><span class="p">,</span>
</span><span id="1-13">    <span class="n">lambda_stmt</span><span class="p">,</span>
</span><span id="1-14">    <span class="n">over</span><span class="p">,</span>
</span><span id="1-15">    <span class="n">select</span><span class="p">,</span>
</span><span id="1-16">    <span class="n">text</span><span class="p">,</span>
</span><span id="1-17">    <span class="n">update</span><span class="p">,</span>
</span><span id="1-18"><span class="p">)</span>
</span><span id="1-19"><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span> <span class="k">as</span> <span class="n">sql_func</span>
</span><span id="1-20"><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span> <span class="n">Session</span>
</span><span id="1-21"><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">ColumnElement</span><span class="p">,</span> <span class="n">ColumnExpressionArgument</span>
</span><span id="1-22">
</span><span id="1-23"><span class="kn">from</span> <span class="nn">advanced_alchemy.exceptions</span> <span class="kn">import</span> <span class="n">NotFoundError</span><span class="p">,</span> <span class="n">RepositoryError</span>
</span><span id="1-24"><span class="kn">from</span> <span class="nn">advanced_alchemy.filters</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-25">    <span class="n">BeforeAfter</span><span class="p">,</span>
</span><span id="1-26">    <span class="n">CollectionFilter</span><span class="p">,</span>
</span><span id="1-27">    <span class="n">FilterTypes</span><span class="p">,</span>
</span><span id="1-28">    <span class="n">LimitOffset</span><span class="p">,</span>
</span><span id="1-29">    <span class="n">NotInCollectionFilter</span><span class="p">,</span>
</span><span id="1-30">    <span class="n">NotInSearchFilter</span><span class="p">,</span>
</span><span id="1-31">    <span class="n">OnBeforeAfter</span><span class="p">,</span>
</span><span id="1-32">    <span class="n">OrderBy</span><span class="p">,</span>
</span><span id="1-33">    <span class="n">SearchFilter</span><span class="p">,</span>
</span><span id="1-34"><span class="p">)</span>
</span><span id="1-35"><span class="kn">from</span> <span class="nn">advanced_alchemy.operations</span> <span class="kn">import</span> <span class="n">Merge</span>
</span><span id="1-36"><span class="kn">from</span> <span class="nn">advanced_alchemy.repository._util</span> <span class="kn">import</span> <span class="n">get_instrumented_attr</span><span class="p">,</span> <span class="n">wrap_sqlalchemy_exception</span>
</span><span id="1-37"><span class="kn">from</span> <span class="nn">advanced_alchemy.repository.typing</span> <span class="kn">import</span> <span class="n">ModelT</span>
</span><span id="1-38">
</span><span id="1-39"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-40">    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">abc</span>
</span><span id="1-41">    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="1-42">
</span><span id="1-43">    <span class="kn">from</span> <span class="nn">sqlalchemy.engine.interfaces</span> <span class="kn">import</span> <span class="n">_CoreSingleExecuteParams</span>
</span><span id="1-44">
</span><span id="1-45"><span class="n">DEFAULT_INSERTMANYVALUES_MAX_PARAMETERS</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">950</span>
</span><span id="1-46"><span class="n">POSTGRES_VERSION_SUPPORTING_MERGE</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="1-47">
</span><span id="1-48"><span class="n">WhereClauseT</span> <span class="o">=</span> <span class="n">ColumnExpressionArgument</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
</span><span id="1-49">
</span><span id="1-50">
<div class="viewcode-block" id="SQLAlchemySyncRepository"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository">[docs]</a></span><span id="1-51"><span class="k">class</span> <span class="nc">SQLAlchemySyncRepository</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]):</span>
</span><span id="1-52"><span class="w">    </span><span class="sd">&quot;&quot;&quot;SQLAlchemy based implementation of the repository interface.&quot;&quot;&quot;</span>
</span><span id="1-53">
</span><span id="1-54">    <span class="n">model_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]</span>
</span><span id="1-55">    <span class="n">id_attribute</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span>
</span><span id="1-56">    <span class="n">match_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-57">
<div class="viewcode-block" id="SQLAlchemySyncRepository.__init__"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.__init__">[docs]</a></span><span id="1-58">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-59">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-60">        <span class="o">*</span><span class="p">,</span>
</span><span id="1-61">        <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-62">        <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span>
</span><span id="1-63">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-64">        <span class="n">auto_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-65">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-66">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-67">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-68"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Repository pattern for SQLAlchemy models.</span>
</span><span id="1-69">
</span><span id="1-70"><span class="sd">        Args:</span>
</span><span id="1-71"><span class="sd">            statement: To facilitate customization of the underlying select query.</span>
</span><span id="1-72"><span class="sd">            session: Session managing the unit-of-work for the operation.</span>
</span><span id="1-73"><span class="sd">            auto_expunge: Remove object from session before returning.</span>
</span><span id="1-74"><span class="sd">            auto_refresh: Refresh object from session before returning.</span>
</span><span id="1-75"><span class="sd">            auto_commit: Commit objects before returning.</span>
</span><span id="1-76"><span class="sd">            **kwargs: Additional arguments.</span>
</span><span id="1-77">
</span><span id="1-78"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-79">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-80">        <span class="bp">self</span><span class="o">.</span><span class="n">auto_expunge</span> <span class="o">=</span> <span class="n">auto_expunge</span>
</span><span id="1-81">        <span class="bp">self</span><span class="o">.</span><span class="n">auto_refresh</span> <span class="o">=</span> <span class="n">auto_refresh</span>
</span><span id="1-82">        <span class="bp">self</span><span class="o">.</span><span class="n">auto_commit</span> <span class="o">=</span> <span class="n">auto_commit</span>
</span><span id="1-83">        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
</span><span id="1-84">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">Select</span><span class="p">):</span>
</span><span id="1-85">            <span class="bp">self</span><span class="o">.</span><span class="n">statement</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">statement</span><span class="p">)</span>
</span><span id="1-86">        <span class="k">elif</span> <span class="n">statement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-87">            <span class="n">statement</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">)</span>
</span><span id="1-88">            <span class="bp">self</span><span class="o">.</span><span class="n">statement</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">statement</span><span class="p">)</span>
</span><span id="1-89">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-90">            <span class="bp">self</span><span class="o">.</span><span class="n">statement</span> <span class="o">=</span> <span class="n">statement</span>
</span><span id="1-91">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">bind</span><span class="p">:</span>
</span><span id="1-92">            <span class="c1"># this shouldn&#39;t actually ever happen, but we include it anyway to properly</span>
</span><span id="1-93">            <span class="c1"># narrow down the types</span>
</span><span id="1-94">            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Session improperly configure&quot;</span>
</span><span id="1-95">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="1-96">        <span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">bind</span><span class="o">.</span><span class="n">dialect</span></div>
</span><span id="1-97">
<div class="viewcode-block" id="SQLAlchemySyncRepository.get_id_attribute_value"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.get_id_attribute_value">[docs]</a></span><span id="1-98">    <span class="nd">@classmethod</span>
</span><span id="1-99">    <span class="k">def</span> <span class="nf">get_id_attribute_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">ModelT</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span> <span class="n">id_attribute</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-100"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get value of attribute named as :attr:`id_attribute &lt;AbstractAsyncRepository.id_attribute&gt;` on ``item``.</span>
</span><span id="1-101">
</span><span id="1-102"><span class="sd">        Args:</span>
</span><span id="1-103"><span class="sd">            item: Anything that should have an attribute named as :attr:`id_attribute &lt;AbstractAsyncRepository.id_attribute&gt;` value.</span>
</span><span id="1-104"><span class="sd">            id_attribute: Allows customization of the unique identifier to use for model fetching.</span>
</span><span id="1-105"><span class="sd">                Defaults to `None`, but can reference any surrogate or candidate key for the table.</span>
</span><span id="1-106">
</span><span id="1-107"><span class="sd">        Returns:</span>
</span><span id="1-108"><span class="sd">            The value of attribute on ``item`` named as :attr:`id_attribute &lt;AbstractAsyncRepository.id_attribute&gt;`.</span>
</span><span id="1-109"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-110">        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">id_attribute</span> <span class="k">if</span> <span class="n">id_attribute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">cls</span><span class="o">.</span><span class="n">id_attribute</span><span class="p">)</span></div>
</span><span id="1-111">
<div class="viewcode-block" id="SQLAlchemySyncRepository.set_id_attribute_value"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.set_id_attribute_value">[docs]</a></span><span id="1-112">    <span class="nd">@classmethod</span>
</span><span id="1-113">    <span class="k">def</span> <span class="nf">set_id_attribute_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">item_id</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">ModelT</span><span class="p">,</span> <span class="n">id_attribute</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelT</span><span class="p">:</span>
</span><span id="1-114"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the ``item`` after the ID is set to the appropriate attribute.</span>
</span><span id="1-115">
</span><span id="1-116"><span class="sd">        Args:</span>
</span><span id="1-117"><span class="sd">            item_id: Value of ID to be set on instance</span>
</span><span id="1-118"><span class="sd">            item: Anything that should have an attribute named as :attr:`id_attribute &lt;AbstractAsyncRepository.id_attribute&gt;` value.</span>
</span><span id="1-119"><span class="sd">            id_attribute: Allows customization of the unique identifier to use for model fetching.</span>
</span><span id="1-120"><span class="sd">                Defaults to `None`, but can reference any surrogate or candidate key for the table.</span>
</span><span id="1-121">
</span><span id="1-122"><span class="sd">        Returns:</span>
</span><span id="1-123"><span class="sd">            Item with ``item_id`` set to :attr:`id_attribute &lt;AbstractAsyncRepository.id_attribute&gt;`</span>
</span><span id="1-124"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-125">        <span class="nb">setattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">id_attribute</span> <span class="k">if</span> <span class="n">id_attribute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">cls</span><span class="o">.</span><span class="n">id_attribute</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
</span><span id="1-126">        <span class="k">return</span> <span class="n">item</span></div>
</span><span id="1-127">
<div class="viewcode-block" id="SQLAlchemySyncRepository.check_not_found"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.check_not_found">[docs]</a></span><span id="1-128">    <span class="nd">@staticmethod</span>
</span><span id="1-129">    <span class="k">def</span> <span class="nf">check_not_found</span><span class="p">(</span><span class="n">item_or_none</span><span class="p">:</span> <span class="n">ModelT</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelT</span><span class="p">:</span>
</span><span id="1-130"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Raise :exc:`advanced_alchemy.exceptions.NotFoundError` if ``item_or_none`` is ``None``.</span>
</span><span id="1-131">
</span><span id="1-132"><span class="sd">        Args:</span>
</span><span id="1-133"><span class="sd">            item_or_none: Item (:class:`T &lt;T&gt;`) to be tested for existence.</span>
</span><span id="1-134">
</span><span id="1-135"><span class="sd">        Returns:</span>
</span><span id="1-136"><span class="sd">            The item, if it exists.</span>
</span><span id="1-137"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-138">        <span class="k">if</span> <span class="n">item_or_none</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-139">            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No item found when one was expected&quot;</span>
</span><span id="1-140">            <span class="k">raise</span> <span class="n">NotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="1-141">        <span class="k">return</span> <span class="n">item_or_none</span></div>
</span><span id="1-142">
<div class="viewcode-block" id="SQLAlchemySyncRepository.add"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.add">[docs]</a></span><span id="1-143">    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span>
</span><span id="1-144">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-145">        <span class="n">data</span><span class="p">:</span> <span class="n">ModelT</span><span class="p">,</span>
</span><span id="1-146">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-147">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-148">        <span class="n">auto_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-149">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelT</span><span class="p">:</span>
</span><span id="1-150"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add ``data`` to the collection.</span>
</span><span id="1-151">
</span><span id="1-152"><span class="sd">        Args:</span>
</span><span id="1-153"><span class="sd">            data: Instance to be added to the collection.</span>
</span><span id="1-154"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-155"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-156"><span class="sd">            auto_refresh: Refresh object from session before returning. Defaults to</span>
</span><span id="1-157"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_refresh &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-158"><span class="sd">            auto_commit: Commit objects before returning. Defaults to</span>
</span><span id="1-159"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-160">
</span><span id="1-161"><span class="sd">        Returns:</span>
</span><span id="1-162"><span class="sd">            The added instance.</span>
</span><span id="1-163"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-164">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-165">            <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attach_to_session</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="1-166">            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_or_commit</span><span class="p">(</span><span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">)</span>
</span><span id="1-167">            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_refresh</span><span class="o">=</span><span class="n">auto_refresh</span><span class="p">)</span>
</span><span id="1-168">            <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-169">            <span class="k">return</span> <span class="n">instance</span></div>
</span><span id="1-170">
<div class="viewcode-block" id="SQLAlchemySyncRepository.add_many"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.add_many">[docs]</a></span><span id="1-171">    <span class="k">def</span> <span class="nf">add_many</span><span class="p">(</span>
</span><span id="1-172">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-173">        <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span>
</span><span id="1-174">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-175">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-176">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]:</span>
</span><span id="1-177"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add many `data` to the collection.</span>
</span><span id="1-178">
</span><span id="1-179"><span class="sd">        Args:</span>
</span><span id="1-180"><span class="sd">            data: list of Instances to be added to the collection.</span>
</span><span id="1-181"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-182"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-183"><span class="sd">            auto_commit: Commit objects before returning. Defaults to</span>
</span><span id="1-184"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-185">
</span><span id="1-186"><span class="sd">        Returns:</span>
</span><span id="1-187"><span class="sd">            The added instances.</span>
</span><span id="1-188"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-189">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-190">            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="1-191">            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_or_commit</span><span class="p">(</span><span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">)</span>
</span><span id="1-192">            <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="1-193">                <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-194">            <span class="k">return</span> <span class="n">data</span></div>
</span><span id="1-195">
<div class="viewcode-block" id="SQLAlchemySyncRepository.delete"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.delete">[docs]</a></span><span id="1-196">    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span>
</span><span id="1-197">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-198">        <span class="n">item_id</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-199">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-200">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-201">        <span class="n">id_attribute</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-202">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelT</span><span class="p">:</span>
</span><span id="1-203"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete instance identified by ``item_id``.</span>
</span><span id="1-204">
</span><span id="1-205"><span class="sd">        Args:</span>
</span><span id="1-206"><span class="sd">            item_id: Identifier of instance to be deleted.</span>
</span><span id="1-207"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-208"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-209"><span class="sd">            auto_commit: Commit objects before returning. Defaults to</span>
</span><span id="1-210"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-211"><span class="sd">            id_attribute: Allows customization of the unique identifier to use for model fetching.</span>
</span><span id="1-212"><span class="sd">                Defaults to `id`, but can reference any surrogate or candidate key for the table.</span>
</span><span id="1-213">
</span><span id="1-214"><span class="sd">        Returns:</span>
</span><span id="1-215"><span class="sd">            The deleted instance.</span>
</span><span id="1-216">
</span><span id="1-217"><span class="sd">        Raises:</span>
</span><span id="1-218"><span class="sd">            NotFoundError: If no instance found identified by ``item_id``.</span>
</span><span id="1-219"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-220">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-221">            <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item_id</span><span class="p">,</span> <span class="n">id_attribute</span><span class="o">=</span><span class="n">id_attribute</span><span class="p">)</span>
</span><span id="1-222">            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span id="1-223">            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_or_commit</span><span class="p">(</span><span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">)</span>
</span><span id="1-224">            <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-225">            <span class="k">return</span> <span class="n">instance</span></div>
</span><span id="1-226">
<div class="viewcode-block" id="SQLAlchemySyncRepository.delete_many"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.delete_many">[docs]</a></span><span id="1-227">    <span class="k">def</span> <span class="nf">delete_many</span><span class="p">(</span>
</span><span id="1-228">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-229">        <span class="n">item_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-230">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-231">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-232">        <span class="n">id_attribute</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-233">        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-234">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]:</span>
</span><span id="1-235"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete instance identified by `item_id`.</span>
</span><span id="1-236">
</span><span id="1-237"><span class="sd">        Args:</span>
</span><span id="1-238"><span class="sd">            item_ids: Identifier of instance to be deleted.</span>
</span><span id="1-239"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-240"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-241"><span class="sd">            auto_commit: Commit objects before returning. Defaults to</span>
</span><span id="1-242"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-243"><span class="sd">            id_attribute: Allows customization of the unique identifier to use for model fetching.</span>
</span><span id="1-244"><span class="sd">                Defaults to `id`, but can reference any surrogate or candidate key for the table.</span>
</span><span id="1-245"><span class="sd">            chunk_size: Allows customization of the ``insertmanyvalues_max_parameters`` setting for the driver.</span>
</span><span id="1-246"><span class="sd">                Defaults to `950` if left unset.</span>
</span><span id="1-247">
</span><span id="1-248"><span class="sd">        Returns:</span>
</span><span id="1-249"><span class="sd">            The deleted instances.</span>
</span><span id="1-250">
</span><span id="1-251"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-252">
</span><span id="1-253">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-254">            <span class="n">id_attribute</span> <span class="o">=</span> <span class="n">get_instrumented_attr</span><span class="p">(</span>
</span><span id="1-255">                <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span>
</span><span id="1-256">                <span class="n">id_attribute</span> <span class="k">if</span> <span class="n">id_attribute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_attribute</span><span class="p">,</span>
</span><span id="1-257">            <span class="p">)</span>
</span><span id="1-258">            <span class="n">instances</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-259">            <span class="n">chunk_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_insertmanyvalues_max_parameters</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
</span><span id="1-260">            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_ids</span><span class="p">),</span> <span class="n">chunk_size</span><span class="p">):</span>
</span><span id="1-261">                <span class="n">chunk</span> <span class="o">=</span> <span class="n">item_ids</span><span class="p">[</span><span class="n">idx</span> <span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_ids</span><span class="p">))]</span>
</span><span id="1-262">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">delete_executemany_returning</span><span class="p">:</span>
</span><span id="1-263">                    <span class="n">instances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="1-264">                        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
</span><span id="1-265">                            <span class="bp">self</span><span class="o">.</span><span class="n">_get_delete_many_statement</span><span class="p">(</span>
</span><span id="1-266">                                <span class="n">statement_type</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span>
</span><span id="1-267">                                <span class="n">model_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span>
</span><span id="1-268">                                <span class="n">id_attribute</span><span class="o">=</span><span class="n">id_attribute</span><span class="p">,</span>
</span><span id="1-269">                                <span class="n">id_chunk</span><span class="o">=</span><span class="n">chunk</span><span class="p">,</span>
</span><span id="1-270">                                <span class="n">supports_returning</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">delete_executemany_returning</span><span class="p">,</span>
</span><span id="1-271">                            <span class="p">),</span>
</span><span id="1-272">                        <span class="p">),</span>
</span><span id="1-273">                    <span class="p">)</span>
</span><span id="1-274">                <span class="k">else</span><span class="p">:</span>
</span><span id="1-275">                    <span class="n">instances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="1-276">                        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
</span><span id="1-277">                            <span class="bp">self</span><span class="o">.</span><span class="n">_get_delete_many_statement</span><span class="p">(</span>
</span><span id="1-278">                                <span class="n">statement_type</span><span class="o">=</span><span class="s2">&quot;select&quot;</span><span class="p">,</span>
</span><span id="1-279">                                <span class="n">model_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span>
</span><span id="1-280">                                <span class="n">id_attribute</span><span class="o">=</span><span class="n">id_attribute</span><span class="p">,</span>
</span><span id="1-281">                                <span class="n">id_chunk</span><span class="o">=</span><span class="n">chunk</span><span class="p">,</span>
</span><span id="1-282">                                <span class="n">supports_returning</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">delete_executemany_returning</span><span class="p">,</span>
</span><span id="1-283">                            <span class="p">),</span>
</span><span id="1-284">                        <span class="p">),</span>
</span><span id="1-285">                    <span class="p">)</span>
</span><span id="1-286">                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="1-287">                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_delete_many_statement</span><span class="p">(</span>
</span><span id="1-288">                            <span class="n">statement_type</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span>
</span><span id="1-289">                            <span class="n">model_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span>
</span><span id="1-290">                            <span class="n">id_attribute</span><span class="o">=</span><span class="n">id_attribute</span><span class="p">,</span>
</span><span id="1-291">                            <span class="n">id_chunk</span><span class="o">=</span><span class="n">chunk</span><span class="p">,</span>
</span><span id="1-292">                            <span class="n">supports_returning</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">delete_executemany_returning</span><span class="p">,</span>
</span><span id="1-293">                        <span class="p">),</span>
</span><span id="1-294">                    <span class="p">)</span>
</span><span id="1-295">            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_or_commit</span><span class="p">(</span><span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">)</span>
</span><span id="1-296">            <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
</span><span id="1-297">                <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-298">            <span class="k">return</span> <span class="n">instances</span></div>
</span><span id="1-299">
</span><span id="1-300">    <span class="k">def</span> <span class="nf">_get_insertmanyvalues_max_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="1-301">        <span class="k">return</span> <span class="n">chunk_size</span> <span class="k">if</span> <span class="n">chunk_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">DEFAULT_INSERTMANYVALUES_MAX_PARAMETERS</span>
</span><span id="1-302">
<div class="viewcode-block" id="SQLAlchemySyncRepository.exists"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.exists">[docs]</a></span><span id="1-303">    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span>
</span><span id="1-304">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-305">        <span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">FilterTypes</span> <span class="o">|</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="1-306">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-307">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-308"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return true if the object specified by ``kwargs`` exists.</span>
</span><span id="1-309">
</span><span id="1-310"><span class="sd">        Args:</span>
</span><span id="1-311"><span class="sd">            *filters: Types for specific filtering operations.</span>
</span><span id="1-312"><span class="sd">            **kwargs: Identifier of the instance to be retrieved.</span>
</span><span id="1-313">
</span><span id="1-314"><span class="sd">        Returns:</span>
</span><span id="1-315"><span class="sd">            True if the instance was found.  False if not found..</span>
</span><span id="1-316">
</span><span id="1-317"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-318">        <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-319">        <span class="k">return</span> <span class="n">existing</span> <span class="o">&gt;</span> <span class="mi">0</span></div>
</span><span id="1-320">
</span><span id="1-321">    <span class="k">def</span> <span class="nf">_get_base_stmt</span><span class="p">(</span>
</span><span id="1-322">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-323">        <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-324">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-325">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">Select</span><span class="p">):</span>
</span><span id="1-326">            <span class="k">return</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">statement</span><span class="p">)</span>
</span><span id="1-327">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statement</span> <span class="k">if</span> <span class="n">statement</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">statement</span>
</span><span id="1-328">
</span><span id="1-329">    <span class="nd">@staticmethod</span>
</span><span id="1-330">    <span class="k">def</span> <span class="nf">_get_delete_many_statement</span><span class="p">(</span>
</span><span id="1-331">        <span class="n">model_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span>
</span><span id="1-332">        <span class="n">id_attribute</span><span class="p">:</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span>
</span><span id="1-333">        <span class="n">id_chunk</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-334">        <span class="n">supports_returning</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="1-335">        <span class="n">statement_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span>
</span><span id="1-336">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-337">        <span class="k">if</span> <span class="n">statement_type</span> <span class="o">==</span> <span class="s2">&quot;delete&quot;</span><span class="p">:</span>
</span><span id="1-338">            <span class="n">statement</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">delete</span><span class="p">(</span><span class="n">model_type</span><span class="p">))</span>
</span><span id="1-339">        <span class="k">elif</span> <span class="n">statement_type</span> <span class="o">==</span> <span class="s2">&quot;select&quot;</span><span class="p">:</span>
</span><span id="1-340">            <span class="n">statement</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">select</span><span class="p">(</span><span class="n">model_type</span><span class="p">))</span>
</span><span id="1-341">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">id_attribute</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">id_chunk</span><span class="p">))</span>
</span><span id="1-342">        <span class="k">if</span> <span class="n">supports_returning</span> <span class="ow">and</span> <span class="n">statement_type</span> <span class="o">!=</span> <span class="s2">&quot;select&quot;</span><span class="p">:</span>
</span><span id="1-343">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span>
</span><span id="1-344">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-345">
<div class="viewcode-block" id="SQLAlchemySyncRepository.get"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.get">[docs]</a></span><span id="1-346">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
</span><span id="1-347">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-348">        <span class="n">item_id</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-349">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-350">        <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-351">        <span class="n">id_attribute</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-352">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelT</span><span class="p">:</span>
</span><span id="1-353"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get instance identified by `item_id`.</span>
</span><span id="1-354">
</span><span id="1-355"><span class="sd">        Args:</span>
</span><span id="1-356"><span class="sd">            item_id: Identifier of the instance to be retrieved.</span>
</span><span id="1-357"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-358"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-359"><span class="sd">            statement: To facilitate customization of the underlying select query.</span>
</span><span id="1-360"><span class="sd">                Defaults to :class:`SQLAlchemySyncRepository.statement &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-361"><span class="sd">            id_attribute: Allows customization of the unique identifier to use for model fetching.</span>
</span><span id="1-362"><span class="sd">                Defaults to `id`, but can reference any surrogate or candidate key for the table.</span>
</span><span id="1-363">
</span><span id="1-364"><span class="sd">        Returns:</span>
</span><span id="1-365"><span class="sd">            The retrieved instance.</span>
</span><span id="1-366">
</span><span id="1-367"><span class="sd">        Raises:</span>
</span><span id="1-368"><span class="sd">            NotFoundError: If no instance found identified by `item_id`.</span>
</span><span id="1-369"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-370">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-371">            <span class="n">id_attribute</span> <span class="o">=</span> <span class="n">id_attribute</span> <span class="k">if</span> <span class="n">id_attribute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_attribute</span>
</span><span id="1-372">            <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stmt</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-373">            <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_select_by_kwargs</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="p">[(</span><span class="n">id_attribute</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)])</span>
</span><span id="1-374">            <span class="n">instance</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">statement</span><span class="p">))</span><span class="o">.</span><span class="n">scalar_one_or_none</span><span class="p">()</span>
</span><span id="1-375">            <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_not_found</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span id="1-376">            <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-377">            <span class="k">return</span> <span class="n">instance</span></div>
</span><span id="1-378">
<div class="viewcode-block" id="SQLAlchemySyncRepository.get_one"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.get_one">[docs]</a></span><span id="1-379">    <span class="k">def</span> <span class="nf">get_one</span><span class="p">(</span>
</span><span id="1-380">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-381">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-382">        <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-383">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-384">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelT</span><span class="p">:</span>
</span><span id="1-385"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get instance identified by ``kwargs``.</span>
</span><span id="1-386">
</span><span id="1-387"><span class="sd">        Args:</span>
</span><span id="1-388"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-389"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-390"><span class="sd">            statement: To facilitate customization of the underlying select query.</span>
</span><span id="1-391"><span class="sd">                Defaults to :class:`SQLAlchemySyncRepository.statement &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-392"><span class="sd">            **kwargs: Identifier of the instance to be retrieved.</span>
</span><span id="1-393">
</span><span id="1-394"><span class="sd">        Returns:</span>
</span><span id="1-395"><span class="sd">            The retrieved instance.</span>
</span><span id="1-396">
</span><span id="1-397"><span class="sd">        Raises:</span>
</span><span id="1-398"><span class="sd">            NotFoundError: If no instance found identified by `item_id`.</span>
</span><span id="1-399"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-400">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-401">            <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stmt</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-402">            <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_select_by_kwargs</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-403">            <span class="n">instance</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">statement</span><span class="p">))</span><span class="o">.</span><span class="n">scalar_one_or_none</span><span class="p">()</span>
</span><span id="1-404">            <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_not_found</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span id="1-405">            <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-406">            <span class="k">return</span> <span class="n">instance</span></div>
</span><span id="1-407">
<div class="viewcode-block" id="SQLAlchemySyncRepository.get_one_or_none"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.get_one_or_none">[docs]</a></span><span id="1-408">    <span class="k">def</span> <span class="nf">get_one_or_none</span><span class="p">(</span>
</span><span id="1-409">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-410">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-411">        <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-412">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-413">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelT</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-414"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get instance identified by ``kwargs`` or None if not found.</span>
</span><span id="1-415">
</span><span id="1-416"><span class="sd">        Args:</span>
</span><span id="1-417"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-418"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-419"><span class="sd">            statement: To facilitate customization of the underlying select query.</span>
</span><span id="1-420"><span class="sd">                Defaults to :class:`SQLAlchemySyncRepository.statement &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-421"><span class="sd">            **kwargs: Identifier of the instance to be retrieved.</span>
</span><span id="1-422">
</span><span id="1-423"><span class="sd">        Returns:</span>
</span><span id="1-424"><span class="sd">            The retrieved instance or None</span>
</span><span id="1-425"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-426">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-427">            <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stmt</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-428">            <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_select_by_kwargs</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-429">            <span class="n">instance</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;Result[tuple[ModelT]]&quot;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)))</span><span class="o">.</span><span class="n">scalar_one_or_none</span><span class="p">()</span>
</span><span id="1-430">            <span class="k">if</span> <span class="n">instance</span><span class="p">:</span>
</span><span id="1-431">                <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-432">            <span class="k">return</span> <span class="n">instance</span></div>
</span><span id="1-433">
<div class="viewcode-block" id="SQLAlchemySyncRepository.get_or_create"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.get_or_create">[docs]</a></span><span id="1-434">    <span class="k">def</span> <span class="nf">get_or_create</span><span class="p">(</span>
</span><span id="1-435">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-436">        <span class="n">match_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-437">        <span class="n">upsert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-438">        <span class="n">attribute_names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-439">        <span class="n">with_for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-440">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-441">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-442">        <span class="n">auto_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-443">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-444">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="1-445"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get instance identified by ``kwargs`` or create if it doesn&#39;t exist.</span>
</span><span id="1-446">
</span><span id="1-447"><span class="sd">        Args:</span>
</span><span id="1-448"><span class="sd">            match_fields: a list of keys to use to match the existing model.  When</span>
</span><span id="1-449"><span class="sd">                empty, all fields are matched.</span>
</span><span id="1-450"><span class="sd">            upsert: When using match_fields and actual model values differ from</span>
</span><span id="1-451"><span class="sd">                `kwargs`, perform an update operation on the model.</span>
</span><span id="1-452"><span class="sd">            attribute_names: an iterable of attribute names to pass into the ``update``</span>
</span><span id="1-453"><span class="sd">                method.</span>
</span><span id="1-454"><span class="sd">            with_for_update: indicating FOR UPDATE should be used, or may be a</span>
</span><span id="1-455"><span class="sd">                dictionary containing flags to indicate a more specific set of</span>
</span><span id="1-456"><span class="sd">                FOR UPDATE flags for the SELECT</span>
</span><span id="1-457"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-458"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-459"><span class="sd">            auto_refresh: Refresh object from session before returning. Defaults to</span>
</span><span id="1-460"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_refresh &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-461"><span class="sd">            auto_commit: Commit objects before returning. Defaults to</span>
</span><span id="1-462"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-463"><span class="sd">            **kwargs: Identifier of the instance to be retrieved.</span>
</span><span id="1-464">
</span><span id="1-465"><span class="sd">        Returns:</span>
</span><span id="1-466"><span class="sd">            a tuple that includes the instance and whether it needed to be created.</span>
</span><span id="1-467"><span class="sd">            When using match_fields and actual model values differ from ``kwargs``, the</span>
</span><span id="1-468"><span class="sd">            model value will be updated.</span>
</span><span id="1-469"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-470">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_or_upsert</span><span class="p">(</span>
</span><span id="1-471">            <span class="n">match_fields</span><span class="o">=</span><span class="n">match_fields</span><span class="p">,</span>
</span><span id="1-472">            <span class="n">upsert</span><span class="o">=</span><span class="n">upsert</span><span class="p">,</span>
</span><span id="1-473">            <span class="n">attribute_names</span><span class="o">=</span><span class="n">attribute_names</span><span class="p">,</span>
</span><span id="1-474">            <span class="n">with_for_update</span><span class="o">=</span><span class="n">with_for_update</span><span class="p">,</span>
</span><span id="1-475">            <span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">,</span>
</span><span id="1-476">            <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">,</span>
</span><span id="1-477">            <span class="n">auto_refresh</span><span class="o">=</span><span class="n">auto_refresh</span><span class="p">,</span>
</span><span id="1-478">            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="1-479">        <span class="p">)</span></div>
</span><span id="1-480">
<div class="viewcode-block" id="SQLAlchemySyncRepository.get_or_upsert"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.get_or_upsert">[docs]</a></span><span id="1-481">    <span class="k">def</span> <span class="nf">get_or_upsert</span><span class="p">(</span>
</span><span id="1-482">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-483">        <span class="n">match_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-484">        <span class="n">upsert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-485">        <span class="n">attribute_names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-486">        <span class="n">with_for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-487">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-488">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-489">        <span class="n">auto_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-490">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-491">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="1-492"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get instance identified by ``kwargs`` or create if it doesn&#39;t exist.</span>
</span><span id="1-493">
</span><span id="1-494"><span class="sd">        Args:</span>
</span><span id="1-495"><span class="sd">            match_fields: a list of keys to use to match the existing model.  When</span>
</span><span id="1-496"><span class="sd">                empty, all fields are matched.</span>
</span><span id="1-497"><span class="sd">            upsert: When using match_fields and actual model values differ from</span>
</span><span id="1-498"><span class="sd">                `kwargs`, perform an update operation on the model.</span>
</span><span id="1-499"><span class="sd">            attribute_names: an iterable of attribute names to pass into the ``update``</span>
</span><span id="1-500"><span class="sd">                method.</span>
</span><span id="1-501"><span class="sd">            with_for_update: indicating FOR UPDATE should be used, or may be a</span>
</span><span id="1-502"><span class="sd">                dictionary containing flags to indicate a more specific set of</span>
</span><span id="1-503"><span class="sd">                FOR UPDATE flags for the SELECT</span>
</span><span id="1-504"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-505"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-506"><span class="sd">            auto_refresh: Refresh object from session before returning. Defaults to</span>
</span><span id="1-507"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_refresh &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-508"><span class="sd">            auto_commit: Commit objects before returning. Defaults to</span>
</span><span id="1-509"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-510"><span class="sd">            **kwargs: Identifier of the instance to be retrieved.</span>
</span><span id="1-511">
</span><span id="1-512"><span class="sd">        Returns:</span>
</span><span id="1-513"><span class="sd">            a tuple that includes the instance and whether it needed to be created.</span>
</span><span id="1-514"><span class="sd">            When using match_fields and actual model values differ from ``kwargs``, the</span>
</span><span id="1-515"><span class="sd">            model value will be updated.</span>
</span><span id="1-516"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-517">        <span class="n">match_fields</span> <span class="o">=</span> <span class="n">match_fields</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_fields</span>
</span><span id="1-518">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match_fields</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-519">            <span class="n">match_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_fields</span><span class="p">]</span>
</span><span id="1-520">        <span class="k">if</span> <span class="n">match_fields</span><span class="p">:</span>
</span><span id="1-521">            <span class="n">match_filter</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-522">                <span class="n">field_name</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-523">                <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">match_fields</span>
</span><span id="1-524">                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-525">            <span class="p">}</span>
</span><span id="1-526">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-527">            <span class="n">match_filter</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="1-528">        <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_one_or_none</span><span class="p">(</span><span class="o">**</span><span class="n">match_filter</span><span class="p">)</span>
</span><span id="1-529">        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing</span><span class="p">:</span>
</span><span id="1-530">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)),</span> <span class="kc">True</span>  <span class="c1"># pyright: ignore[reportGeneralTypeIssues]</span>
</span><span id="1-531">        <span class="k">if</span> <span class="n">upsert</span><span class="p">:</span>
</span><span id="1-532">            <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">new_field_value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="1-533">                <span class="n">field</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-534">                <span class="k">if</span> <span class="n">field</span> <span class="ow">and</span> <span class="n">field</span> <span class="o">!=</span> <span class="n">new_field_value</span><span class="p">:</span>
</span><span id="1-535">                    <span class="nb">setattr</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">new_field_value</span><span class="p">)</span>
</span><span id="1-536">            <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attach_to_session</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;merge&quot;</span><span class="p">)</span>
</span><span id="1-537">            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_or_commit</span><span class="p">(</span><span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">)</span>
</span><span id="1-538">            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh</span><span class="p">(</span>
</span><span id="1-539">                <span class="n">existing</span><span class="p">,</span>
</span><span id="1-540">                <span class="n">attribute_names</span><span class="o">=</span><span class="n">attribute_names</span><span class="p">,</span>
</span><span id="1-541">                <span class="n">with_for_update</span><span class="o">=</span><span class="n">with_for_update</span><span class="p">,</span>
</span><span id="1-542">                <span class="n">auto_refresh</span><span class="o">=</span><span class="n">auto_refresh</span><span class="p">,</span>
</span><span id="1-543">            <span class="p">)</span>
</span><span id="1-544">            <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-545">        <span class="k">return</span> <span class="n">existing</span><span class="p">,</span> <span class="kc">False</span></div>
</span><span id="1-546">
<div class="viewcode-block" id="SQLAlchemySyncRepository.count"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.count">[docs]</a></span><span id="1-547">    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span>
</span><span id="1-548">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-549">        <span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">FilterTypes</span> <span class="o">|</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="1-550">        <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-551">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-552">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="1-553"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the count of records returned by a query.</span>
</span><span id="1-554">
</span><span id="1-555"><span class="sd">        Args:</span>
</span><span id="1-556"><span class="sd">            *filters: Types for specific filtering operations.</span>
</span><span id="1-557"><span class="sd">            statement: To facilitate customization of the underlying select query.</span>
</span><span id="1-558"><span class="sd">                Defaults to :class:`SQLAlchemySyncRepository.statement &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-559"><span class="sd">            **kwargs: Instance attribute value filters.</span>
</span><span id="1-560">
</span><span id="1-561"><span class="sd">        Returns:</span>
</span><span id="1-562"><span class="sd">            Count of records returned by query, ignoring pagination.</span>
</span><span id="1-563"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-564">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stmt</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-565">        <span class="n">fragment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id_attribute_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">)</span>
</span><span id="1-566">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">with_only_columns</span><span class="p">(</span><span class="n">sql_func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">fragment</span><span class="p">),</span> <span class="n">maintain_column_froms</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="1-567">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="1-568">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_select_by_kwargs</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-569">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_filters</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">,</span> <span class="n">apply_pagination</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-570">        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-571">        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">scalar_one</span><span class="p">())</span></div>
</span><span id="1-572">
<div class="viewcode-block" id="SQLAlchemySyncRepository.update"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.update">[docs]</a></span><span id="1-573">    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
</span><span id="1-574">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-575">        <span class="n">data</span><span class="p">:</span> <span class="n">ModelT</span><span class="p">,</span>
</span><span id="1-576">        <span class="n">attribute_names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-577">        <span class="n">with_for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-578">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-579">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-580">        <span class="n">auto_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-581">        <span class="n">id_attribute</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-582">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelT</span><span class="p">:</span>
</span><span id="1-583"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update instance with the attribute values present on `data`.</span>
</span><span id="1-584">
</span><span id="1-585"><span class="sd">        Args:</span>
</span><span id="1-586"><span class="sd">            data: An instance that should have a value for `self.id_attribute` that</span>
</span><span id="1-587"><span class="sd">                exists in the collection.</span>
</span><span id="1-588"><span class="sd">            attribute_names: an iterable of attribute names to pass into the ``update``</span>
</span><span id="1-589"><span class="sd">                method.</span>
</span><span id="1-590"><span class="sd">            with_for_update: indicating FOR UPDATE should be used, or may be a</span>
</span><span id="1-591"><span class="sd">                dictionary containing flags to indicate a more specific set of</span>
</span><span id="1-592"><span class="sd">                FOR UPDATE flags for the SELECT</span>
</span><span id="1-593"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-594"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-595"><span class="sd">            auto_refresh: Refresh object from session before returning. Defaults to</span>
</span><span id="1-596"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_refresh &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-597"><span class="sd">            auto_commit: Commit objects before returning. Defaults to</span>
</span><span id="1-598"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-599"><span class="sd">            id_attribute: Allows customization of the unique identifier to use for model fetching.</span>
</span><span id="1-600"><span class="sd">                Defaults to `id`, but can reference any surrogate or candidate key for the table.</span>
</span><span id="1-601">
</span><span id="1-602"><span class="sd">        Returns:</span>
</span><span id="1-603"><span class="sd">            The updated instance.</span>
</span><span id="1-604">
</span><span id="1-605"><span class="sd">        Raises:</span>
</span><span id="1-606"><span class="sd">            NotFoundError: If no instance found with same identifier as `data`.</span>
</span><span id="1-607"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-608">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-609">            <span class="n">item_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id_attribute_value</span><span class="p">(</span>
</span><span id="1-610">                <span class="n">data</span><span class="p">,</span>
</span><span id="1-611">                <span class="n">id_attribute</span><span class="o">=</span><span class="n">id_attribute</span><span class="o">.</span><span class="n">key</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">id_attribute</span><span class="p">,</span> <span class="n">InstrumentedAttribute</span><span class="p">)</span> <span class="k">else</span> <span class="n">id_attribute</span><span class="p">,</span>
</span><span id="1-612">            <span class="p">)</span>
</span><span id="1-613">            <span class="c1"># this will raise for not found, and will put the item in the session</span>
</span><span id="1-614">            <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item_id</span><span class="p">,</span> <span class="n">id_attribute</span><span class="o">=</span><span class="n">id_attribute</span><span class="p">)</span>
</span><span id="1-615">            <span class="c1"># this will merge the inbound data to the instance we just put in the session</span>
</span><span id="1-616">            <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attach_to_session</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;merge&quot;</span><span class="p">)</span>
</span><span id="1-617">            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_or_commit</span><span class="p">(</span><span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">)</span>
</span><span id="1-618">            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh</span><span class="p">(</span>
</span><span id="1-619">                <span class="n">instance</span><span class="p">,</span>
</span><span id="1-620">                <span class="n">attribute_names</span><span class="o">=</span><span class="n">attribute_names</span><span class="p">,</span>
</span><span id="1-621">                <span class="n">with_for_update</span><span class="o">=</span><span class="n">with_for_update</span><span class="p">,</span>
</span><span id="1-622">                <span class="n">auto_refresh</span><span class="o">=</span><span class="n">auto_refresh</span><span class="p">,</span>
</span><span id="1-623">            <span class="p">)</span>
</span><span id="1-624">            <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-625">            <span class="k">return</span> <span class="n">instance</span></div>
</span><span id="1-626">
<div class="viewcode-block" id="SQLAlchemySyncRepository.update_many"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.update_many">[docs]</a></span><span id="1-627">    <span class="k">def</span> <span class="nf">update_many</span><span class="p">(</span>
</span><span id="1-628">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-629">        <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span>
</span><span id="1-630">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-631">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-632">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]:</span>
</span><span id="1-633"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update one or more instances with the attribute values present on `data`.</span>
</span><span id="1-634">
</span><span id="1-635"><span class="sd">        This function has an optimized bulk update based on the configured SQL dialect:</span>
</span><span id="1-636"><span class="sd">        - For backends supporting `RETURNING` with `executemany`, a single bulk update with returning clause is executed.</span>
</span><span id="1-637"><span class="sd">        - For other backends, it does a bulk update and then returns the updated data after a refresh.</span>
</span><span id="1-638">
</span><span id="1-639"><span class="sd">        Args:</span>
</span><span id="1-640"><span class="sd">            data: A list of instances to update.  Each should have a value for `self.id_attribute` that exists in the</span>
</span><span id="1-641"><span class="sd">                collection.</span>
</span><span id="1-642"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-643"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-644"><span class="sd">            auto_commit: Commit objects before returning. Defaults to</span>
</span><span id="1-645"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-646">
</span><span id="1-647"><span class="sd">        Returns:</span>
</span><span id="1-648"><span class="sd">            The updated instances.</span>
</span><span id="1-649">
</span><span id="1-650"><span class="sd">        Raises:</span>
</span><span id="1-651"><span class="sd">            NotFoundError: If no instance found with same identifier as `data`.</span>
</span><span id="1-652"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-653">        <span class="n">data_to_update</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="1-654">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-655">            <span class="n">supports_returning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">update_executemany_returning</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;oracle&quot;</span>
</span><span id="1-656">            <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_update_many_statement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span> <span class="n">supports_returning</span><span class="p">)</span>
</span><span id="1-657">            <span class="k">if</span> <span class="n">supports_returning</span><span class="p">:</span>
</span><span id="1-658">                <span class="n">instances</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="1-659">                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
</span><span id="1-660">                        <span class="n">statement</span><span class="p">,</span>
</span><span id="1-661">                        <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;_CoreSingleExecuteParams&quot;</span><span class="p">,</span> <span class="n">data_to_update</span><span class="p">),</span>  <span class="c1"># this is not correct but the only way</span>
</span><span id="1-662">                        <span class="c1"># currently to deal with an SQLAlchemy typing issue. See</span>
</span><span id="1-663">                        <span class="c1"># https://github.com/sqlalchemy/sqlalchemy/discussions/9925</span>
</span><span id="1-664">                    <span class="p">),</span>
</span><span id="1-665">                <span class="p">)</span>
</span><span id="1-666">                <span class="bp">self</span><span class="o">.</span><span class="n">_flush_or_commit</span><span class="p">(</span><span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">)</span>
</span><span id="1-667">                <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
</span><span id="1-668">                    <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-669">                <span class="k">return</span> <span class="n">instances</span>
</span><span id="1-670">            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">data_to_update</span><span class="p">)</span>
</span><span id="1-671">            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_or_commit</span><span class="p">(</span><span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">)</span>
</span><span id="1-672">            <span class="k">return</span> <span class="n">data</span></div>
</span><span id="1-673">
</span><span id="1-674">    <span class="nd">@staticmethod</span>
</span><span id="1-675">    <span class="k">def</span> <span class="nf">_get_update_many_statement</span><span class="p">(</span><span class="n">model_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span> <span class="n">supports_returning</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-676">        <span class="n">statement</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">update</span><span class="p">(</span><span class="n">model_type</span><span class="p">))</span>
</span><span id="1-677">        <span class="k">if</span> <span class="n">supports_returning</span><span class="p">:</span>
</span><span id="1-678">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span>
</span><span id="1-679">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-680">
<div class="viewcode-block" id="SQLAlchemySyncRepository.list_and_count"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.list_and_count">[docs]</a></span><span id="1-681">    <span class="k">def</span> <span class="nf">list_and_count</span><span class="p">(</span>
</span><span id="1-682">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-683">        <span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">FilterTypes</span> <span class="o">|</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="1-684">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-685">        <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-686">        <span class="n">force_basic_query_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-687">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-688">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="1-689"><span class="w">        </span><span class="sd">&quot;&quot;&quot;List records with total count.</span>
</span><span id="1-690">
</span><span id="1-691"><span class="sd">        Args:</span>
</span><span id="1-692"><span class="sd">            *filters: Types for specific filtering operations.</span>
</span><span id="1-693"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-694"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-695"><span class="sd">            statement: To facilitate customization of the underlying select query.</span>
</span><span id="1-696"><span class="sd">                Defaults to :class:`SQLAlchemySyncRepository.statement &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-697"><span class="sd">            force_basic_query_mode: Force list and count to use two queries instead of an analytical window function.</span>
</span><span id="1-698"><span class="sd">            **kwargs: Instance attribute value filters.</span>
</span><span id="1-699">
</span><span id="1-700"><span class="sd">        Returns:</span>
</span><span id="1-701"><span class="sd">            Count of records returned by query, ignoring pagination.</span>
</span><span id="1-702"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-703">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;spanner&quot;</span><span class="p">,</span> <span class="s2">&quot;spanner+spanner&quot;</span><span class="p">}</span> <span class="ow">or</span> <span class="n">force_basic_query_mode</span><span class="p">:</span>
</span><span id="1-704">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_and_count_basic</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-705">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_and_count_window</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</span><span id="1-706">
</span><span id="1-707">    <span class="k">def</span> <span class="nf">_expunge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">ModelT</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-708">        <span class="k">if</span> <span class="n">auto_expunge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-709">            <span class="n">auto_expunge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_expunge</span>
</span><span id="1-710">
</span><span id="1-711">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="k">if</span> <span class="n">auto_expunge</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="1-712">
</span><span id="1-713">    <span class="k">def</span> <span class="nf">_flush_or_commit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-714">        <span class="k">if</span> <span class="n">auto_commit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-715">            <span class="n">auto_commit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_commit</span>
</span><span id="1-716">
</span><span id="1-717">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span> <span class="k">if</span> <span class="n">auto_commit</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="1-718">
</span><span id="1-719">    <span class="k">def</span> <span class="nf">_refresh</span><span class="p">(</span>
</span><span id="1-720">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-721">        <span class="n">instance</span><span class="p">:</span> <span class="n">ModelT</span><span class="p">,</span>
</span><span id="1-722">        <span class="n">auto_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-723">        <span class="n">attribute_names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-724">        <span class="n">with_for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-725">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-726">        <span class="k">if</span> <span class="n">auto_refresh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-727">            <span class="n">auto_refresh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_refresh</span>
</span><span id="1-728">
</span><span id="1-729">        <span class="k">return</span> <span class="p">(</span>
</span><span id="1-730">            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attribute_names</span><span class="o">=</span><span class="n">attribute_names</span><span class="p">,</span> <span class="n">with_for_update</span><span class="o">=</span><span class="n">with_for_update</span><span class="p">)</span>
</span><span id="1-731">            <span class="k">if</span> <span class="n">auto_refresh</span>
</span><span id="1-732">            <span class="k">else</span> <span class="kc">None</span>
</span><span id="1-733">        <span class="p">)</span>
</span><span id="1-734">
</span><span id="1-735">    <span class="k">def</span> <span class="nf">_list_and_count_window</span><span class="p">(</span>
</span><span id="1-736">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-737">        <span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">FilterTypes</span> <span class="o">|</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="1-738">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-739">        <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-740">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-741">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="1-742"><span class="w">        </span><span class="sd">&quot;&quot;&quot;List records with total count.</span>
</span><span id="1-743">
</span><span id="1-744"><span class="sd">        Args:</span>
</span><span id="1-745"><span class="sd">            *filters: Types for specific filtering operations.</span>
</span><span id="1-746"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-747"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-748"><span class="sd">            statement: To facilitate customization of the underlying select query.</span>
</span><span id="1-749"><span class="sd">                Defaults to :class:`SQLAlchemySyncRepository.statement &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-750"><span class="sd">            **kwargs: Instance attribute value filters.</span>
</span><span id="1-751">
</span><span id="1-752"><span class="sd">        Returns:</span>
</span><span id="1-753"><span class="sd">            Count of records returned by query using an analytical window function, ignoring pagination.</span>
</span><span id="1-754"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-755">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stmt</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-756">        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id_attribute_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">)</span>
</span><span id="1-757">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span><span class="n">over</span><span class="p">(</span><span class="n">sql_func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">field</span><span class="p">)))</span>
</span><span id="1-758">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_filters</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-759">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_select_by_kwargs</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-760">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-761">            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-762">            <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="1-763">            <span class="n">instances</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-764">            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">count_value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
</span><span id="1-765">                <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-766">                <span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span id="1-767">                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="1-768">                    <span class="n">count</span> <span class="o">=</span> <span class="n">count_value</span>
</span><span id="1-769">            <span class="k">return</span> <span class="n">instances</span><span class="p">,</span> <span class="n">count</span>
</span><span id="1-770">
</span><span id="1-771">    <span class="k">def</span> <span class="nf">_list_and_count_basic</span><span class="p">(</span>
</span><span id="1-772">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-773">        <span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">FilterTypes</span> <span class="o">|</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="1-774">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-775">        <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-776">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-777">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="1-778"><span class="w">        </span><span class="sd">&quot;&quot;&quot;List records with total count.</span>
</span><span id="1-779">
</span><span id="1-780"><span class="sd">        Args:</span>
</span><span id="1-781"><span class="sd">            *filters: Types for specific filtering operations.</span>
</span><span id="1-782"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-783"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-784"><span class="sd">            statement: To facilitate customization of the underlying select query.</span>
</span><span id="1-785"><span class="sd">                Defaults to :class:`SQLAlchemySyncRepository.statement &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-786"><span class="sd">            **kwargs: Instance attribute value filters.</span>
</span><span id="1-787">
</span><span id="1-788"><span class="sd">        Returns:</span>
</span><span id="1-789"><span class="sd">            Count of records returned by query using 2 queries, ignoring pagination.</span>
</span><span id="1-790"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-791">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stmt</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-792">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_filters</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-793">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_select_by_kwargs</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-794">
</span><span id="1-795">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-796">            <span class="n">count_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_count_stmt</span><span class="p">(</span><span class="n">statement</span><span class="p">))</span>
</span><span id="1-797">            <span class="n">count</span> <span class="o">=</span> <span class="n">count_result</span><span class="o">.</span><span class="n">scalar_one</span><span class="p">()</span>
</span><span id="1-798">            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-799">            <span class="n">instances</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-800">            <span class="k">for</span> <span class="p">(</span><span class="n">instance</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="1-801">                <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-802">                <span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span id="1-803">            <span class="k">return</span> <span class="n">instances</span><span class="p">,</span> <span class="n">count</span>
</span><span id="1-804">
</span><span id="1-805">    <span class="k">def</span> <span class="nf">_get_count_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-806">        <span class="n">fragment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id_attribute_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">)</span>
</span><span id="1-807">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">with_only_columns</span><span class="p">(</span><span class="n">sql_func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">fragment</span><span class="p">),</span> <span class="n">maintain_column_froms</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="1-808">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="1-809">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-810">
<div class="viewcode-block" id="SQLAlchemySyncRepository.upsert"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.upsert">[docs]</a></span><span id="1-811">    <span class="k">def</span> <span class="nf">upsert</span><span class="p">(</span>
</span><span id="1-812">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-813">        <span class="n">data</span><span class="p">:</span> <span class="n">ModelT</span><span class="p">,</span>
</span><span id="1-814">        <span class="n">attribute_names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-815">        <span class="n">with_for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-816">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-817">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-818">        <span class="n">auto_refresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-819">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelT</span><span class="p">:</span>
</span><span id="1-820"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update or create instance.</span>
</span><span id="1-821">
</span><span id="1-822"><span class="sd">        Updates instance with the attribute values present on `data`, or creates a new instance if</span>
</span><span id="1-823"><span class="sd">        one doesn&#39;t exist.</span>
</span><span id="1-824">
</span><span id="1-825"><span class="sd">        Args:</span>
</span><span id="1-826"><span class="sd">            data: Instance to update existing, or be created. Identifier used to determine if an</span>
</span><span id="1-827"><span class="sd">                existing instance exists is the value of an attribute on `data` named as value of</span>
</span><span id="1-828"><span class="sd">                `self.id_attribute`.</span>
</span><span id="1-829"><span class="sd">            attribute_names: an iterable of attribute names to pass into the ``update`` method.</span>
</span><span id="1-830"><span class="sd">            with_for_update: indicating FOR UPDATE should be used, or may be a</span>
</span><span id="1-831"><span class="sd">                dictionary containing flags to indicate a more specific set of</span>
</span><span id="1-832"><span class="sd">                FOR UPDATE flags for the SELECT</span>
</span><span id="1-833"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-834"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-835"><span class="sd">            auto_refresh: Refresh object from session before returning. Defaults to</span>
</span><span id="1-836"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_refresh &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-837"><span class="sd">            auto_commit: Commit objects before returning. Defaults to</span>
</span><span id="1-838"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-839">
</span><span id="1-840"><span class="sd">        Returns:</span>
</span><span id="1-841"><span class="sd">            The updated or created instance.</span>
</span><span id="1-842">
</span><span id="1-843"><span class="sd">        Raises:</span>
</span><span id="1-844"><span class="sd">            NotFoundError: If no instance found with same identifier as `data`.</span>
</span><span id="1-845"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-846">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-847">            <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attach_to_session</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;merge&quot;</span><span class="p">)</span>
</span><span id="1-848">            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_or_commit</span><span class="p">(</span><span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">)</span>
</span><span id="1-849">            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh</span><span class="p">(</span>
</span><span id="1-850">                <span class="n">instance</span><span class="p">,</span>
</span><span id="1-851">                <span class="n">attribute_names</span><span class="o">=</span><span class="n">attribute_names</span><span class="p">,</span>
</span><span id="1-852">                <span class="n">with_for_update</span><span class="o">=</span><span class="n">with_for_update</span><span class="p">,</span>
</span><span id="1-853">                <span class="n">auto_refresh</span><span class="o">=</span><span class="n">auto_refresh</span><span class="p">,</span>
</span><span id="1-854">            <span class="p">)</span>
</span><span id="1-855">            <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-856">            <span class="k">return</span> <span class="n">instance</span></div>
</span><span id="1-857">
</span><span id="1-858">    <span class="k">def</span> <span class="nf">_supports_merge_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_disable_merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-859">        <span class="k">return</span> <span class="p">(</span>
</span><span id="1-860">            <span class="p">(</span>
</span><span id="1-861">                <span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">server_version_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-862">                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">server_version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">POSTGRES_VERSION_SUPPORTING_MERGE</span>
</span><span id="1-863">                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;postgresql&quot;</span>
</span><span id="1-864">            <span class="p">)</span>
</span><span id="1-865">            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dialect</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;oracle&quot;</span>
</span><span id="1-866">        <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_disable_merge</span>
</span><span id="1-867">
</span><span id="1-868">    <span class="k">def</span> <span class="nf">_get_merge_stmt</span><span class="p">(</span>
</span><span id="1-869">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-870">        <span class="n">into</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-871">        <span class="n">using</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-872">        <span class="n">on</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-873">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Merge</span><span class="p">:</span>
</span><span id="1-874">        <span class="k">return</span> <span class="n">Merge</span><span class="p">(</span><span class="n">into</span><span class="o">=</span><span class="n">into</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="n">using</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">)</span>
</span><span id="1-875">
<div class="viewcode-block" id="SQLAlchemySyncRepository.upsert_many"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.upsert_many">[docs]</a></span><span id="1-876">    <span class="k">def</span> <span class="nf">upsert_many</span><span class="p">(</span>
</span><span id="1-877">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-878">        <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span>
</span><span id="1-879">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-880">        <span class="n">auto_commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-881">        <span class="n">no_merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-882">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]:</span>
</span><span id="1-883"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update or create instance.</span>
</span><span id="1-884">
</span><span id="1-885"><span class="sd">        Update instances with the attribute values present on `data`, or create a new instance if</span>
</span><span id="1-886"><span class="sd">        one doesn&#39;t exist.</span>
</span><span id="1-887">
</span><span id="1-888"><span class="sd">        Args:</span>
</span><span id="1-889"><span class="sd">            data: Instance to update existing, or be created. Identifier used to determine if an</span>
</span><span id="1-890"><span class="sd">                existing instance exists is the value of an attribute on ``data`` named as value of</span>
</span><span id="1-891"><span class="sd">                :attr:`~advanced_alchemy.repository.AbstractAsyncRepository.id_attribute`.</span>
</span><span id="1-892"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-893"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`.</span>
</span><span id="1-894"><span class="sd">            auto_commit: Commit objects before returning. Defaults to</span>
</span><span id="1-895"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-896"><span class="sd">            no_merge: Skip the usage of optimized Merge statements</span>
</span><span id="1-897"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_commit &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-898">
</span><span id="1-899"><span class="sd">        Returns:</span>
</span><span id="1-900"><span class="sd">            The updated or created instance.</span>
</span><span id="1-901">
</span><span id="1-902"><span class="sd">        Raises:</span>
</span><span id="1-903"><span class="sd">            NotFoundError: If no instance found with same identifier as ``data``.</span>
</span><span id="1-904"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-905">        <span class="n">instances</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-906">        <span class="n">data_to_update</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-907">        <span class="n">data_to_insert</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-908">
</span><span id="1-909">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-910">            <span class="n">existing_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
</span><span id="1-911">                <span class="n">CollectionFilter</span><span class="p">(</span>
</span><span id="1-912">                    <span class="n">field_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id_attribute</span><span class="p">,</span>
</span><span id="1-913">                    <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_attribute</span><span class="p">)</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">data</span><span class="p">],</span>
</span><span id="1-914">                <span class="p">),</span>
</span><span id="1-915">            <span class="p">)</span>
</span><span id="1-916">            <span class="n">existing_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_attribute</span><span class="p">)</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">existing_objs</span><span class="p">]</span>
</span><span id="1-917">            <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="1-918">                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_attribute</span><span class="p">)</span> <span class="ow">in</span> <span class="n">existing_ids</span><span class="p">:</span>
</span><span id="1-919">                    <span class="n">data_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
</span><span id="1-920">                <span class="k">else</span><span class="p">:</span>
</span><span id="1-921">                    <span class="n">data_to_insert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
</span><span id="1-922">            <span class="k">if</span> <span class="n">data_to_insert</span><span class="p">:</span>
</span><span id="1-923">                <span class="n">instances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="1-924">                    <span class="bp">self</span><span class="o">.</span><span class="n">add_many</span><span class="p">(</span><span class="n">data_to_insert</span><span class="p">,</span> <span class="n">auto_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span id="1-925">                <span class="p">)</span>
</span><span id="1-926">            <span class="k">if</span> <span class="n">data_to_update</span><span class="p">:</span>
</span><span id="1-927">                <span class="n">instances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="1-928">                    <span class="bp">self</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span><span class="n">data_to_update</span><span class="p">,</span> <span class="n">auto_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span id="1-929">                <span class="p">)</span>
</span><span id="1-930">            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_or_commit</span><span class="p">(</span><span class="n">auto_commit</span><span class="o">=</span><span class="n">auto_commit</span><span class="p">)</span>
</span><span id="1-931">            <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
</span><span id="1-932">                <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-933">        <span class="k">return</span> <span class="n">instances</span></div>
</span><span id="1-934">
<div class="viewcode-block" id="SQLAlchemySyncRepository.list"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.list">[docs]</a></span><span id="1-935">    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span>
</span><span id="1-936">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-937">        <span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">FilterTypes</span> <span class="o">|</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="1-938">        <span class="n">auto_expunge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-939">        <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-940">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-941">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]:</span>
</span><span id="1-942"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of instances, optionally filtered.</span>
</span><span id="1-943">
</span><span id="1-944"><span class="sd">        Args:</span>
</span><span id="1-945"><span class="sd">            *filters: Types for specific filtering operations.</span>
</span><span id="1-946"><span class="sd">            auto_expunge: Remove object from session before returning. Defaults to</span>
</span><span id="1-947"><span class="sd">                :class:`SQLAlchemySyncRepository.auto_expunge &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-948"><span class="sd">            statement: To facilitate customization of the underlying select query.</span>
</span><span id="1-949"><span class="sd">                Defaults to :class:`SQLAlchemySyncRepository.statement &lt;SQLAlchemySyncRepository&gt;`</span>
</span><span id="1-950"><span class="sd">            **kwargs: Instance attribute value filters.</span>
</span><span id="1-951">
</span><span id="1-952"><span class="sd">        Returns:</span>
</span><span id="1-953"><span class="sd">            The list of instances, after filtering applied.</span>
</span><span id="1-954"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-955">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stmt</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-956">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_filters</span><span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-957">        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_select_by_kwargs</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-958">
</span><span id="1-959">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-960">            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-961">            <span class="n">instances</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">scalars</span><span class="p">())</span>
</span><span id="1-962">            <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
</span><span id="1-963">                <span class="bp">self</span><span class="o">.</span><span class="n">_expunge</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">auto_expunge</span><span class="o">=</span><span class="n">auto_expunge</span><span class="p">)</span>
</span><span id="1-964">            <span class="k">return</span> <span class="n">instances</span></div>
</span><span id="1-965">
<div class="viewcode-block" id="SQLAlchemySyncRepository.filter_collection_by_kwargs"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.filter_collection_by_kwargs">[docs]</a></span><span id="1-966">    <span class="k">def</span> <span class="nf">filter_collection_by_kwargs</span><span class="p">(</span>
</span><span id="1-967">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-968">        <span class="n">collection</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ModelT</span><span class="p">]]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-969">        <span class="o">/</span><span class="p">,</span>
</span><span id="1-970">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-971">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-972"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter the collection by kwargs.</span>
</span><span id="1-973">
</span><span id="1-974"><span class="sd">        Args:</span>
</span><span id="1-975"><span class="sd">            collection: statement to filter</span>
</span><span id="1-976"><span class="sd">            **kwargs: key/value pairs such that objects remaining in the collection after filtering</span>
</span><span id="1-977"><span class="sd">                have the property that their attribute named `key` has value equal to `value`.</span>
</span><span id="1-978"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-979">        <span class="k">with</span> <span class="n">wrap_sqlalchemy_exception</span><span class="p">():</span>
</span><span id="1-980">            <span class="n">collection</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">collection</span><span class="p">)</span>
</span><span id="1-981">            <span class="n">collection</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-982">            <span class="k">return</span> <span class="n">collection</span></div>
</span><span id="1-983">
<div class="viewcode-block" id="SQLAlchemySyncRepository.check_health"><a class="viewcode-back" href="../../../reference/repository.html#advanced_alchemy.repository.SQLAlchemySyncRepository.check_health">[docs]</a></span><span id="1-984">    <span class="nd">@classmethod</span>
</span><span id="1-985">    <span class="k">def</span> <span class="nf">check_health</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-986"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform a health check on the database.</span>
</span><span id="1-987">
</span><span id="1-988"><span class="sd">        Args:</span>
</span><span id="1-989"><span class="sd">            session: through which we run a check statement</span>
</span><span id="1-990">
</span><span id="1-991"><span class="sd">        Returns:</span>
</span><span id="1-992"><span class="sd">            ``True`` if healthy.</span>
</span><span id="1-993"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-994">
</span><span id="1-995">        <span class="k">return</span> <span class="p">(</span>  <span class="c1"># type:ignore[no-any-return]</span>
</span><span id="1-996">            <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_get_health_check_statement</span><span class="p">(</span><span class="n">session</span><span class="p">))</span>
</span><span id="1-997">        <span class="p">)</span><span class="o">.</span><span class="n">scalar_one</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span></div>
</span><span id="1-998">
</span><span id="1-999">    <span class="nd">@staticmethod</span>
</span><span id="1-1000">    <span class="k">def</span> <span class="nf">_get_health_check_statement</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TextClause</span><span class="p">:</span>
</span><span id="1-1001">        <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">bind</span> <span class="ow">and</span> <span class="n">session</span><span class="o">.</span><span class="n">bind</span><span class="o">.</span><span class="n">dialect</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;oracle&quot;</span><span class="p">:</span>
</span><span id="1-1002">            <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&quot;SELECT 1 FROM DUAL&quot;</span><span class="p">)</span>
</span><span id="1-1003">        <span class="k">return</span> <span class="n">text</span><span class="p">(</span><span class="s2">&quot;SELECT 1&quot;</span><span class="p">)</span>
</span><span id="1-1004">
</span><span id="1-1005">    <span class="k">def</span> <span class="nf">_attach_to_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">ModelT</span><span class="p">,</span> <span class="n">strategy</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;merge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;add&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelT</span><span class="p">:</span>
</span><span id="1-1006"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Attach detached instance to the session.</span>
</span><span id="1-1007">
</span><span id="1-1008"><span class="sd">        Args:</span>
</span><span id="1-1009"><span class="sd">            model: The instance to be attached to the session.</span>
</span><span id="1-1010"><span class="sd">            strategy: How the instance should be attached.</span>
</span><span id="1-1011"><span class="sd">                - &quot;add&quot;: New instance added to session</span>
</span><span id="1-1012"><span class="sd">                - &quot;merge&quot;: Instance merged with existing, or new one added.</span>
</span><span id="1-1013">
</span><span id="1-1014"><span class="sd">        Returns:</span>
</span><span id="1-1015"><span class="sd">            Instance attached to the session - if `&quot;merge&quot;` strategy, may not be same instance</span>
</span><span id="1-1016"><span class="sd">            that was provided.</span>
</span><span id="1-1017"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1018">        <span class="k">if</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">:</span>
</span><span id="1-1019">            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="1-1020">            <span class="k">return</span> <span class="n">model</span>
</span><span id="1-1021">        <span class="k">if</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;merge&quot;</span><span class="p">:</span>
</span><span id="1-1022">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="1-1023">        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unexpected value for `strategy`, must be `&#39;add&#39;` or `&#39;merge&#39;`&quot;</span>  <span class="c1"># type: ignore[unreachable]</span>
</span><span id="1-1024">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="1-1025">
</span><span id="1-1026">    <span class="k">def</span> <span class="nf">_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">Select</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">StatementLambdaElement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-1027">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-1028">
</span><span id="1-1029">    <span class="k">def</span> <span class="nf">_apply_limit_offset_pagination</span><span class="p">(</span>
</span><span id="1-1030">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1031">        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="1-1032">        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="1-1033">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1034">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1035">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
</span><span id="1-1036">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1037">
</span><span id="1-1038">    <span class="k">def</span> <span class="nf">_apply_filters</span><span class="p">(</span>
</span><span id="1-1039">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1040">        <span class="o">*</span><span class="n">filters</span><span class="p">:</span> <span class="n">FilterTypes</span> <span class="o">|</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="1-1041">        <span class="n">apply_pagination</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-1042">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1043">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1044"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply filters to a select statement.</span>
</span><span id="1-1045">
</span><span id="1-1046"><span class="sd">        Args:</span>
</span><span id="1-1047"><span class="sd">            *filters: filter types to apply to the query</span>
</span><span id="1-1048"><span class="sd">            apply_pagination: applies pagination filters if true</span>
</span><span id="1-1049"><span class="sd">            statement: select statement to apply filters</span>
</span><span id="1-1050">
</span><span id="1-1051"><span class="sd">        Keyword Args:</span>
</span><span id="1-1052"><span class="sd">            select: select to apply filters against</span>
</span><span id="1-1053">
</span><span id="1-1054"><span class="sd">        Returns:</span>
</span><span id="1-1055"><span class="sd">            The select with filters applied.</span>
</span><span id="1-1056"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1057">        <span class="k">for</span> <span class="n">filter_</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
</span><span id="1-1058">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="p">(</span><span class="n">LimitOffset</span><span class="p">,)):</span>
</span><span id="1-1059">                <span class="k">if</span> <span class="n">apply_pagination</span><span class="p">:</span>
</span><span id="1-1060">                    <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_limit_offset_pagination</span><span class="p">(</span><span class="n">filter_</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span> <span class="n">filter_</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-1061">            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="p">(</span><span class="n">BeforeAfter</span><span class="p">,)):</span>
</span><span id="1-1062">                <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_on_datetime_field</span><span class="p">(</span>
</span><span id="1-1063">                    <span class="n">field_name</span><span class="o">=</span><span class="n">filter_</span><span class="o">.</span><span class="n">field_name</span><span class="p">,</span>
</span><span id="1-1064">                    <span class="n">before</span><span class="o">=</span><span class="n">filter_</span><span class="o">.</span><span class="n">before</span><span class="p">,</span>
</span><span id="1-1065">                    <span class="n">after</span><span class="o">=</span><span class="n">filter_</span><span class="o">.</span><span class="n">after</span><span class="p">,</span>
</span><span id="1-1066">                    <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span>
</span><span id="1-1067">                <span class="p">)</span>
</span><span id="1-1068">            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="p">(</span><span class="n">OnBeforeAfter</span><span class="p">,)):</span>
</span><span id="1-1069">                <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_on_datetime_field</span><span class="p">(</span>
</span><span id="1-1070">                    <span class="n">field_name</span><span class="o">=</span><span class="n">filter_</span><span class="o">.</span><span class="n">field_name</span><span class="p">,</span>
</span><span id="1-1071">                    <span class="n">on_or_before</span><span class="o">=</span><span class="n">filter_</span><span class="o">.</span><span class="n">on_or_before</span><span class="p">,</span>
</span><span id="1-1072">                    <span class="n">on_or_after</span><span class="o">=</span><span class="n">filter_</span><span class="o">.</span><span class="n">on_or_after</span><span class="p">,</span>
</span><span id="1-1073">                    <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span>
</span><span id="1-1074">                <span class="p">)</span>
</span><span id="1-1075">
</span><span id="1-1076">            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="p">(</span><span class="n">NotInCollectionFilter</span><span class="p">,)):</span>
</span><span id="1-1077">                <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_not_in_collection</span><span class="p">(</span><span class="n">filter_</span><span class="o">.</span><span class="n">field_name</span><span class="p">,</span> <span class="n">filter_</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-1078">            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="p">(</span><span class="n">CollectionFilter</span><span class="p">,)):</span>
</span><span id="1-1079">                <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_in_collection</span><span class="p">(</span><span class="n">filter_</span><span class="o">.</span><span class="n">field_name</span><span class="p">,</span> <span class="n">filter_</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-1080">            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="p">(</span><span class="n">OrderBy</span><span class="p">,)):</span>
</span><span id="1-1081">                <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_by</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">filter_</span><span class="o">.</span><span class="n">field_name</span><span class="p">,</span> <span class="n">sort_desc</span><span class="o">=</span><span class="n">filter_</span><span class="o">.</span><span class="n">sort_order</span> <span class="o">==</span> <span class="s2">&quot;desc&quot;</span><span class="p">)</span>
</span><span id="1-1082">            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="p">(</span><span class="n">SearchFilter</span><span class="p">,)):</span>
</span><span id="1-1083">                <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_by_like</span><span class="p">(</span>
</span><span id="1-1084">                    <span class="n">statement</span><span class="p">,</span>
</span><span id="1-1085">                    <span class="n">filter_</span><span class="o">.</span><span class="n">field_name</span><span class="p">,</span>
</span><span id="1-1086">                    <span class="n">value</span><span class="o">=</span><span class="n">filter_</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="1-1087">                    <span class="n">ignore_case</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">filter_</span><span class="o">.</span><span class="n">ignore_case</span><span class="p">),</span>
</span><span id="1-1088">                <span class="p">)</span>
</span><span id="1-1089">            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="p">(</span><span class="n">NotInSearchFilter</span><span class="p">,)):</span>
</span><span id="1-1090">                <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_by_not_like</span><span class="p">(</span>
</span><span id="1-1091">                    <span class="n">statement</span><span class="p">,</span>
</span><span id="1-1092">                    <span class="n">filter_</span><span class="o">.</span><span class="n">field_name</span><span class="p">,</span>
</span><span id="1-1093">                    <span class="n">value</span><span class="o">=</span><span class="n">filter_</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="1-1094">                    <span class="n">ignore_case</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">filter_</span><span class="o">.</span><span class="n">ignore_case</span><span class="p">),</span>
</span><span id="1-1095">                <span class="p">)</span>
</span><span id="1-1096">            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">):</span>
</span><span id="1-1097">                <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_by_expression</span><span class="p">(</span><span class="n">expression</span><span class="o">=</span><span class="n">filter_</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">statement</span><span class="p">)</span>
</span><span id="1-1098">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-1099">                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unexpected filter: </span><span class="si">{</span><span class="n">filter_</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># type: ignore[unreachable]</span>
</span><span id="1-1100">                <span class="k">raise</span> <span class="n">RepositoryError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="1-1101">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1102">
</span><span id="1-1103">    <span class="k">def</span> <span class="nf">_filter_in_collection</span><span class="p">(</span>
</span><span id="1-1104">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1105">        <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span>
</span><span id="1-1106">        <span class="n">values</span><span class="p">:</span> <span class="n">abc</span><span class="o">.</span><span class="n">Collection</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-1107">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1108">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1109">        <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
</span><span id="1-1110">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;1=-1&quot;</span><span class="p">))</span>
</span><span id="1-1111">            <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1112">        <span class="n">field</span> <span class="o">=</span> <span class="n">get_instrumented_attr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span><span id="1-1113">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
</span><span id="1-1114">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1115">
</span><span id="1-1116">    <span class="k">def</span> <span class="nf">_filter_not_in_collection</span><span class="p">(</span>
</span><span id="1-1117">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1118">        <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span>
</span><span id="1-1119">        <span class="n">values</span><span class="p">:</span> <span class="n">abc</span><span class="o">.</span><span class="n">Collection</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-1120">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1121">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1122">        <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
</span><span id="1-1123">            <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1124">        <span class="n">field</span> <span class="o">=</span> <span class="n">get_instrumented_attr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span><span id="1-1125">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">notin_</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
</span><span id="1-1126">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1127">
</span><span id="1-1128">    <span class="k">def</span> <span class="nf">_filter_on_datetime_field</span><span class="p">(</span>
</span><span id="1-1129">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1130">        <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span>
</span><span id="1-1131">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1132">        <span class="n">before</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1133">        <span class="n">after</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1134">        <span class="n">on_or_before</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1135">        <span class="n">on_or_after</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1136">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1137">        <span class="n">field</span> <span class="o">=</span> <span class="n">get_instrumented_attr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span><span id="1-1138">        <span class="k">if</span> <span class="n">before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1139">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&lt;</span> <span class="n">before</span><span class="p">)</span>
</span><span id="1-1140">        <span class="k">if</span> <span class="n">after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1141">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&gt;</span> <span class="n">after</span><span class="p">)</span>
</span><span id="1-1142">        <span class="k">if</span> <span class="n">on_or_before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1143">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&lt;=</span> <span class="n">on_or_before</span><span class="p">)</span>
</span><span id="1-1144">        <span class="k">if</span> <span class="n">on_or_after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1145">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&gt;=</span> <span class="n">on_or_after</span><span class="p">)</span>
</span><span id="1-1146">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1147">
</span><span id="1-1148">    <span class="k">def</span> <span class="nf">_filter_select_by_kwargs</span><span class="p">(</span>
</span><span id="1-1149">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1150">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1151">        <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="1-1152">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1153">        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="1-1154">            <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_by_where</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>  <span class="c1"># pyright: ignore[reportGeneralTypeIssues]</span>
</span><span id="1-1155">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1156">
</span><span id="1-1157">    <span class="k">def</span> <span class="nf">_filter_by_expression</span><span class="p">(</span>
</span><span id="1-1158">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1159">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1160">        <span class="n">expression</span><span class="p">:</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="1-1161">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1162">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
</span><span id="1-1163">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1164">
</span><span id="1-1165">    <span class="k">def</span> <span class="nf">_filter_by_where</span><span class="p">(</span>
</span><span id="1-1166">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1167">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1168">        <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span>
</span><span id="1-1169">        <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-1170">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1171">        <span class="n">field</span> <span class="o">=</span> <span class="n">get_instrumented_attr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span><span id="1-1172">        <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span>
</span><span id="1-1173">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1174">
</span><span id="1-1175">    <span class="k">def</span> <span class="nf">_filter_by_like</span><span class="p">(</span>
</span><span id="1-1176">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1177">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1178">        <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span>
</span><span id="1-1179">        <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-1180">        <span class="n">ignore_case</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="1-1181">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1182">        <span class="n">field</span> <span class="o">=</span> <span class="n">get_instrumented_attr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span><span id="1-1183">        <span class="n">search_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;%</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span id="1-1184">        <span class="k">if</span> <span class="n">ignore_case</span><span class="p">:</span>
</span><span id="1-1185">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="n">search_text</span><span class="p">))</span>
</span><span id="1-1186">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1187">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="n">search_text</span><span class="p">))</span>
</span><span id="1-1188">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1189">
</span><span id="1-1190">    <span class="k">def</span> <span class="nf">_filter_by_not_like</span><span class="p">(</span>
</span><span id="1-1191">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1192">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1193">        <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span>
</span><span id="1-1194">        <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-1195">        <span class="n">ignore_case</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="1-1196">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1197">        <span class="n">field</span> <span class="o">=</span> <span class="n">get_instrumented_attr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span><span id="1-1198">        <span class="n">search_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;%</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span id="1-1199">        <span class="k">if</span> <span class="n">ignore_case</span><span class="p">:</span>
</span><span id="1-1200">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">not_ilike</span><span class="p">(</span><span class="n">search_text</span><span class="p">))</span>
</span><span id="1-1201">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1202">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">not_like</span><span class="p">(</span><span class="n">search_text</span><span class="p">))</span>
</span><span id="1-1203">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1204">
</span><span id="1-1205">    <span class="k">def</span> <span class="nf">_order_by</span><span class="p">(</span>
</span><span id="1-1206">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1207">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementLambdaElement</span><span class="p">,</span>
</span><span id="1-1208">        <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span>
</span><span id="1-1209">        <span class="n">sort_desc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-1210">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementLambdaElement</span><span class="p">:</span>
</span><span id="1-1211">        <span class="n">field</span> <span class="o">=</span> <span class="n">get_instrumented_attr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span><span id="1-1212">        <span class="k">if</span> <span class="n">sort_desc</span><span class="p">:</span>
</span><span id="1-1213">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
</span><span id="1-1214">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1215">            <span class="n">statement</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span>
</span><span id="1-1216">        <span class="k">return</span> <span class="n">statement</span></div>
</span></pre></div>
        </article>
        
        <div class="navigation flex print:hidden">
  
  
</div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2023, Jolt Org</p>
        
        <p>
          Made with
          
          <a href="https://www.sphinx-doc.org/">Sphinx</a> and
          
          <a href="https://shibuya.lepture.com">Shibuya theme</a>.
        </p>
      </div>
      <div class="sy-foot-socials">
          <a href="https://github.com/jolt-org/advanced-alchemy" aria-label="GitHub"><i class="i-icon github"></i></a>
      </div>
    </div>
  </div>
</footer></div>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=e43216b9"></script>
      <script src="../../../_static/doctools.js?v=888ff710"></script>
      <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../_static/design-tabs.js?v=36754332"></script>
      <script src="../../../_static/shibuya.js?v=3e5c8598"></script>
    
</body>
</html>